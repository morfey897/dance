---
import { getEnv } from "../../../services/cloudflare";
import Header from "./Header";
import type { HeaderType } from "./types";
import { getIndex } from "../../../utils/md";
import { translateJSON } from "../../../services/translate";

const { lang } = Astro.params;

let navigation = [];
try {
  navigation = await Astro.glob("../../../../content/navigation.md");
} catch (e) {}

const navigationIndex = getIndex(navigation);

const { header } = navigationIndex?.frontmatter || {};

const translation = await translateJSON(
  {
    target: lang,
    content: {
      header: header,
    },
  },
  Astro.request
);

const props: HeaderType = {
  navigation: {
    ...header,
    ...translation?.header,
  },
  url: Astro.url.href,
  lang,
  langs: getEnv(Astro.request).LANGS,
};
---

<Header {...props} client:load />
